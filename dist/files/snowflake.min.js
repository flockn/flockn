udefine("snowflake/addable",["./graphics"],function(a){"use strict";return function(b,c,d){var e=function(){var e=arguments[0],f=2<=arguments.length?[].slice.call(arguments,1):[];e instanceof b||("string"==typeof e?Object.hasOwnProperty.call(store,e)&&(e=new b(b.store[e])):e=new b(e)),c.push(e),e.parent=this,d&&d.call(this,e),a.trigger("add",e),e.apply(f),e.trigger("add",e,f)};return function(){var a=[].slice.call(arguments);return a.unshift(this),e.bind.apply(e,a)}}}),udefine("snowflake/base",["eventmap","mixedice","gameboard/input","./group","./world"],function(a,b,c,d,e){"use strict";var f=0,g=1e4,h=function(a){var b=a+"";if(a>=g)return b;for(var c=(g+"").length-b.length,d=0;c>d;d++)b="0"+b;return b},i=function(g,j){b([this,i.prototype],new a),g=g||"Base",this.type=g,this.name=this.type+"-"+Date.now();var k=h(++f);Object.defineProperty(this,"id",{get:function(){return this.type+"-"+k},enumerable:!0}),this.descriptor=j,this.children=new d,this.queue=[],this.parent=null,this.input=c,this.world=e,this.trigger("constructed")};return i.prototype.call=i.prototype.reset=function(){this.apply(arguments)},i.prototype.apply=function(a){this.descriptor&&(this.descriptor.apply(this,a),this.trigger("execute"),this.queue.forEach(function(a){a&&a()}),this.queue=[])},i.extend=function(a,c,d){var e=new i(c,d);b(a,e)},i}),udefine("snowflake/behavior",["mixedice","./addable","./base","./group","./updateable"],function(a,b,c,d,e){"use strict";var f=function(a){c.extend([this,f.prototype],"Behavior",a),this.gameObject=null,e.call(this)};return f.prototype.addBehavior=function(){this.queue.push(b(f,this.children,function(a){a.gameObject=this.gameObject}).apply(this,arguments))},f.store={},f.define=function(a,b){f.store[a]=b},f}),udefine("snowflake/game",["root","mixedice","gameboard/loop","./addable","./base","./graphics","./scene","./renderable","./updateable"],function(a,b,c,d,e,f,g,h,i){"use strict";var j=function(b){if(!this instanceof j)return new j(b);var d=this;e.extend([this,j.prototype],"Game",function(){b.call(this),f.trigger("initialize",this)}),this.container=null,this.width=a.innerWidth,this.height=a.innerHeight,this.color="rgb(255, 255, 255)",this.call(),h.call(this),i.call(this),c.on("update",function(a){d.trigger("update",a/1e3)}),c.on("render",function(){d.trigger("render")}),a.addEventListener("resize",function(){d.trigger("resize")},!1),a.addEventListener("orientationchange",function(){d.trigger("orientationchange")},!1)};return j.prototype.addScene=function(){this.queue.push(d(g,this.children).apply(this,arguments))},j.prototype.showScene=function(a){this.activeScene=a,this.trigger("show",this.activeScene,this.children[this.activeScene])},j.prototype.run=function(a){c.run(),a&&this.showScene(a)},j}),udefine("snowflake/gameobject",["mixedice","./addable","./base","./behavior","./graphics","./group","./renderable","./serialize","./texture","./updateable"],function(a,b,c,d,e,f,g,h,i,j){"use strict";var k=function(a){c.extend([this,k.prototype],"GameObject",a);var b=this;this.visible=!0,this.x=0,this.y=0,this.texture=new i,this.texture.parent=this,this.texture.on("loaded",function(){b.width=b.texture.data.width,b.height=b.texture.data.height,e.trigger("texture-loaded",b,b.texture)}),this.width=0,this.height=0,this.angle=0,this.alpha=1,this.scale={x:1,y:1},this.behaviors=new f,this.models=new f,g.call(this),j.call(this),this.on("update",function(){b.behaviors.forEach(function(a){a.trigger("update")})})};return k.store={},k.define=function(a,b){k.store[a]=b},k.prototype.addGameObject=function(){this.queue.push(b(k,this.children).apply(this,arguments))},k.prototype.addBehavior=function(){this.queue.push(b(d,this.behaviors,function(a){a.gameObject=this}).apply(this,arguments))},k.prototype.toJSON=function(){return h(this)},k.prototype.fromJSON=function(){},k}),udefine("snowflake/group",["./serialize"],function(a){"use strict";var b="untitled",c=0,d=function(){this.length=0,this.tags={},this.names={}};return d.prototype.push=function(a,d){var e=a.name||b+c++;return null==d&&(d=a.tags||[]),Object.hasOwnProperty.call(this.names,e)?void 0:(this[this.length]=a,Object.keys(this.tags).forEach(function(a){this.tags[a]=this.tags[a]||[],this.tags[a].push(this.length)},this),this.names[e]=this.length,++this.length)},d.prototype.pop=function(){return this[this.length]},d.prototype.splice=function(){},d.prototype.slice=function(a,b){null==b&&(b=this.length);for(var c=new d,e=a;b>e;e++)c.push(this[e]);return c},d.prototype.forEach=function(a){for(var b=0;b<this.length;b++)a(this[b])},d.prototype.map=function(a){for(var b=[],c=0;c<this.length;c++)b.push(a(this[c]));return b},d.prototype.filter=function(a){for(var b=[],c=0;c<this.length;c++)a(this[c])&&b.push(this[c]);return b},d.prototype.byName=function(a){return this[this.names[a]]},d.prototype.byTag=function(a){return this.tags[a].map(function(a){return this[a]},this)},d.prototype.toJSON=function(){return a(this)},d}),udefine("snowflake/renderable",["./graphics"],function(a){"use strict";return function(){var b=this;this.on("render",function(){a.trigger("render",b),b.children.forEach(function(a){a.trigger("render")})})}}),udefine("snowflake/renderer/canvas",["../graphics","../graphics/rootelement"],function(a,b){"use strict";a.renderer="Canvas";var c=null,d=null;a.on("initialize",function(){c=b.call(this,"canvas",function(a){d=a.getContext("2d")})}),a.before("render",function(a){switch(a.type){case"Game":d.clearRect(0,0,a.width,a.height)}}),a.on("render",function(a){switch(a.type){case"GameObject":break;case"Scene":if(a.parent.activeScene!==a.name)return}})}),udefine("snowflake/renderer/dom",["root","../graphics","../graphics/rootelement"],function(a,b,c){"use strict";var d=function(a){return a+"px"},e=function(a){return parseFloat(a)||0};b.renderer="DOM";var f=null;return b.on("initialize",function(a){f=c.call(a,"div",function(a){a.style.backgroundColor=this.color,a.style.overflow="hidden"})}),b.on("add",function(b){var c=b.id.toLowerCase();null!=document.getElementById(c)&&!function(){var a=b.parent.id.toLowerCase(),d=document.getElementById(a);d.removeChild(document.getElementId(c))}();var e=b.parent,g=function(){if(e&&e.isRoot||null==e)return f;var a=b.parent.id.toLowerCase(),c=document.getElementById(a);return null==c?f:c}(),h=document.createElement("div");switch(h.id=c,h.className=[b.type.toLowerCase(),b.name.toLowerCase()].join(" "),h.style.position="absolute",b.type){case"Scene":h.style.width=d(b.parent.width),h.style.height=d(b.parent.height);break;case"GameObject":h.style.left=d(b.x),h.style.top=d(b.y),h.style.width=d(b.width),h.style.height=d(b.height),a.addEventListener("click",function(){},!0)}g.appendChild(h)}),b.on("texture-loaded",function(a,b){var c=document.getElementById(a.id.toLowerCase());null!=c&&(c.style.backgroundImage="url("+b.filename+")",c.style.width=d(a.width),c.style.height=d(a.height))}),b.on("render",function(a){var b=document.getElementById(a.id.toLowerCase());if(null!=b)switch(a.type){case"GameObject":var c="block"===b.style.display;if(c!==a.visible&&(b.style.display=a.visible?"block":"hidden"),!c)return;var f=e(b.style.left),g=e(b.style.top),h=e(b.style.width),i=e(b.style.height);f!==a.x&&(b.style.left=d(a.x)),g!==a.y&&(b.style.top=d(a.y)),h!==a.width&&(b.style.width=d(a.width)),i!==a.height&&(b.style.height=d(a.height)),a.angle&&(b.style.transform=b.style.mozTransform=b.style.webkitTransform="rotate("+a.angle+"deg)"),1!==a.alpha&&(b.style.opacity=a.alpha),a.texture.filename?(0!==a.texture.offset.x&&(b.style.backgroundPositionX=-1*a.texture.offset.x+"px"),0!==a.texture.offset.y&&(b.style.backgroundPositionY=-1*a.texture.offset.y+"px")):b.style.backgroundColor=a.texture.color;break;case"Scene":var j=b.style.display;a.parent.activeScene!==a.name?"hidden"!==j&&(b.style.display="hidden"):"block"!==j&&(b.style.display="block")}}),b}),udefine("snowflake/scene",["mixedice","./addable","./base","./group","./gameobject","./renderable","./updateable"],function(a,b,c,d,e,f,g){"use strict";var h=function(a){c.extend([this,h.prototype],"Scene",a),f.call(this),g.call(this)};return h.prototype.addGameObject=function(){this.queue.push(b(e,this.children).apply(this,arguments))},h.store={},h.define=function(a,b){h.store[a]=b},h}),udefine("snowflake/serialize",function(){"use strict";return function(a){return JSON.stringify(a,function(a,b){return"parent"!==a?("descriptor"===a&&(b=b.toString()),b):void 0})}}),udefine("snowflake/texture",["mixedice","eventmap"],function(a,b){"use strict";var c=function(){a([this,c.prototype],new b);var d=this,e="";this.width=0,this.height=0,this.data=null,this.parent=null,this.offset={x:0,y:0},Object.defineProperty(this,"filename",{get:function(){return e},set:function(a){e=a;var b=new Image;b.src=e,b.onload=function(){d.data=b,d.trigger("loaded")}},enumerable:!0}),this.color="rgb(255, 255, 255)"};return c}),udefine("snowflake/updateable",function(){"use strict";return function(){var a=this;this.on("update",function(b){a.children.forEach(function(a){a.trigger("update",b)})})}}),udefine("snowflake/world",["eventmap"],function(a){"use strict";var b=new a,c={},d={};return c.get=function(a){return Object.hasOwnProperty.call(d,a)?d[a]:void 0},c.set=function(a,b){d[a]=b,c.trigger("change",a,b)},c.on=b.on,c.off=b.off,c.before=b.before,c.after=b.after,c.trigger=b.trigger,c}),udefine("snowflake/renderer/canvas",["../graphics","../graphics/rootelement"],function(a,b){"use strict";a.renderer="Canvas";var c=null,d=null;a.on("initialize",function(){c=b.call(this,"canvas",function(a){d=a.getContext("2d")})}),a.before("render",function(a){switch(a.type){case"Game":d.clearRect(0,0,a.width,a.height)}}),a.on("render",function(a){switch(a.type){case"GameObject":break;case"Scene":if(a.parent.activeScene!==a.name)return}})}),udefine("snowflake/renderer/dom",["root","../graphics","../graphics/rootelement"],function(a,b,c){"use strict";var d=function(a){return a+"px"},e=function(a){return parseFloat(a)||0};b.renderer="DOM";var f=null;return b.on("initialize",function(a){f=c.call(a,"div",function(a){a.style.backgroundColor=this.color,a.style.overflow="hidden"})}),b.on("add",function(b){var c=b.id.toLowerCase();null!=document.getElementById(c)&&!function(){var a=b.parent.id.toLowerCase(),d=document.getElementById(a);d.removeChild(document.getElementId(c))}();var e=b.parent,g=function(){if(e&&e.isRoot||null==e)return f;var a=b.parent.id.toLowerCase(),c=document.getElementById(a);return null==c?f:c}(),h=document.createElement("div");switch(h.id=c,h.className=[b.type.toLowerCase(),b.name.toLowerCase()].join(" "),h.style.position="absolute",b.type){case"Scene":h.style.width=d(b.parent.width),h.style.height=d(b.parent.height);break;case"GameObject":h.style.left=d(b.x),h.style.top=d(b.y),h.style.width=d(b.width),h.style.height=d(b.height),a.addEventListener("click",function(){},!0)}g.appendChild(h)}),b.on("texture-loaded",function(a,b){var c=document.getElementById(a.id.toLowerCase());null!=c&&(c.style.backgroundImage="url("+b.filename+")",c.style.width=d(a.width),c.style.height=d(a.height))}),b.on("render",function(a){var b=document.getElementById(a.id.toLowerCase());if(null!=b)switch(a.type){case"GameObject":var c="block"===b.style.display;if(c!==a.visible&&(b.style.display=a.visible?"block":"hidden"),!c)return;var f=e(b.style.left),g=e(b.style.top),h=e(b.style.width),i=e(b.style.height);f!==a.x&&(b.style.left=d(a.x)),g!==a.y&&(b.style.top=d(a.y)),h!==a.width&&(b.style.width=d(a.width)),i!==a.height&&(b.style.height=d(a.height)),a.angle&&(b.style.transform=b.style.mozTransform=b.style.webkitTransform="rotate("+a.angle+"deg)"),1!==a.alpha&&(b.style.opacity=a.alpha),a.texture.filename?(0!==a.texture.offset.x&&(b.style.backgroundPositionX=-1*a.texture.offset.x+"px"),0!==a.texture.offset.y&&(b.style.backgroundPositionY=-1*a.texture.offset.y+"px")):b.style.backgroundColor=a.texture.color;break;case"Scene":var j=b.style.display;a.parent.activeScene!==a.name?"hidden"!==j&&(b.style.display="hidden"):"block"!==j&&(b.style.display="block")}}),b});