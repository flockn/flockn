{"version":3,"sources":["src/group.js"],"names":[],"mappings":"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","file":"src/group.js","sourcesContent":["import {Log} from 'gamebox';\r\nimport serialize from './serialize';\r\n\r\nvar unidentified = 'untitled';\r\nvar unidentifiedCounter = 0;\r\n\r\nclass Group {\r\n  constructor() {\r\n    this.length = 0;\r\n\r\n    this.ids = {};\r\n    this.tags = {};\r\n    this.names = {};\r\n    this.types = {};\r\n  }\r\n\r\n  push(obj) {\r\n    var {name, tags, id} = obj;\r\n\r\n    name = name || (unidentified + unidentifiedCounter++);\r\n    id = id || (unidentified + unidentifiedCounter++);\r\n    tags = tags || [];\r\n\r\n    if (this.ids[id] != null || this.names[name] != null) {\r\n      Log.w(`An object with the name ${name} or id ${id} already exists`);\r\n      return;\r\n    }\r\n\r\n    var currentLength = Object.keys(this.ids);\r\n    this.ids[id] = obj;\r\n\r\n    Object.keys(this.tags).forEach(tag => {\r\n      this.tags[tag] = this.tags[tag] || [];\r\n      this.tags[tag].push(currentLength);\r\n    });\r\n\r\n    this.names[name] = this.length;\r\n\r\n    if (obj.type != null) {\r\n      this.types[obj.type] = this.types[obj.type] || [];\r\n      this.types[obj.type].push(currentLength);\r\n    }\r\n\r\n    this.length = this.values().length;\r\n    return this.length;\r\n  }\r\n\r\n  pop() {\r\n    var ids = Object.keys(this.ids);\r\n\r\n    for (var i = ids.length, j = 0; j > i; i--) {\r\n      var obj = this.ids[ids[i]];\r\n\r\n      if (obj != null) {\r\n        this.remove(i);\r\n        return obj;\r\n      }\r\n    }\r\n  }\r\n\r\n  values() {\r\n    return Object.keys(this.ids)\r\n      .filter(id => id != null)\r\n      .map(id => this.ids[id]);\r\n  }\r\n\r\n  all(filter) {\r\n    var objects = [];\r\n\r\n    var recurse = function(group) {\r\n      group.forEach(obj => {\r\n        if (filter) {\r\n          if (filter(obj)) {\r\n            objects.push(obj);\r\n          }\r\n        } else {\r\n          objects.push(obj);\r\n        }\r\n\r\n        if (obj.children && obj.children instanceof Group) {\r\n          recurse(obj.children);\r\n        }\r\n      });\r\n    };\r\n\r\n    recurse(this);\r\n\r\n    return objects;\r\n  }\r\n\r\n  forEach(callback) {\r\n    this.values().forEach(obj => callback(obj));\r\n  }\r\n\r\n  map(callback) {\r\n    var mappedArray = new Group();\r\n\r\n    this.forEach(obj => mappedArray.push(callback(obj)));\r\n\r\n    return mappedArray;\r\n  }\r\n\r\n  filter(callback) {\r\n    var filteredArray = new Group();\r\n\r\n    this.forEach(obj => {\r\n      if (callback(obj)) {\r\n        filteredArray.push(obj);\r\n      }\r\n    });\r\n\r\n    return filteredArray;\r\n  }\r\n\r\n  byType(type) {\r\n    return this.types[type].map(index => this[index]);\r\n  }\r\n\r\n  byName(name) {\r\n    var index = this.names[name];\r\n\r\n    return this.ids[Object.keys(this.ids)[index]];\r\n  }\r\n\r\n  byTag(tag) {\r\n    return this.tags[tag].map(index => this[index]);\r\n  }\r\n\r\n  first() {\r\n    return this.values()[0];\r\n  }\r\n\r\n  last() {\r\n    var values = this.values();\r\n\r\n    return values[values.length - 1];\r\n  }\r\n\r\n  find(selector) {\r\n    // TODO: There needs to be a parser here\r\n  }\r\n\r\n  toJSON() {\r\n    return this.values().map(child => {\r\n      if (child.toJSON && typeof child === 'function') {\r\n        return child.toJSON();\r\n      } else {\r\n        return child;\r\n      }\r\n    });\r\n  }\r\n\r\n  toString() {\r\n    return serialize.toString(this.toJSON());\r\n  }\r\n\r\n  static fromJSON(arr) {\r\n    var group = new Group();\r\n\r\n    arr.forEach(obj => group.push(obj));\r\n\r\n    return group;\r\n  }\r\n\r\n  static fromString(str) {\r\n    return Group.fromJSON(JSON.parse(str));\r\n  }\r\n\r\n  remove(index) {\r\n    var id = Object.keys(ids)[index];\r\n\r\n    var obj = this.ids[id];\r\n\r\n    if (obj == null) {\r\n      Log.w(`Object at ${index} does not exist`);\r\n    }\r\n\r\n    var {name, tags} = obj;\r\n\r\n    this.ids[id] = null;\r\n    this.names[name] = null;\r\n\r\n    this.tags.forEach(tag => {\r\n      var position = tag.indexOf(index);\r\n\r\n      if (position >= 0) {\r\n        if (tag.length === 1) {\r\n          this.tags[tag] = [];\r\n        } else {\r\n          this.tags[tag].splice(position, 1);\r\n        }\r\n      }\r\n    });\r\n\r\n    this.length = all().length;\r\n  }\r\n\r\n  removeByName(name) {\r\n    var index = this.names[name];\r\n    this.remove(index);\r\n  }\r\n\r\n  removeByTag(tags) {\r\n    if (!Array.isArray(tags)) {\r\n      tags = [tags];\r\n    }\r\n\r\n    tags.forEach(tag => {\r\n      this.tags[tag].forEach(index => this.remove(index));\r\n      this.tags = [];\r\n    });\r\n  }\r\n}\r\n\r\nexport default Group;\r\n"]}