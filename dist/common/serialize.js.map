{"version":3,"sources":["src/serialize.js"],"names":[],"mappings":"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","file":"src/serialize.js","sourcesContent":["import EventMap from 'eventmap';\n\nvar serialize = {};\n\nserialize.json = {};\n\nserialize.json.filter = ['id', 'parent', 'audio', 'input', 'world', 'assetLoader'];\nserialize.json.defaultReplacer = [];\n\nserialize.json.defaultReplacer.push(function(key, value) {\n  if (key === 'events' && value instanceof EventMap) {\n    value = value.serialize();\n  }\n\n  return value;\n});\n\nserialize.json.defaultReplacer.push(function(key, value) {\n  // Convert image to Base64\n  if (value instanceof Image) {\n    let canvas = document.createElement('canvas');\n    let context = canvas.getContext('2d');\n    canvas.height = this.height;\n    canvas.width = this.width;\n    context.drawImage(this.data, 0, 0);\n    let dataURL = canvas.toDataURL('image/png');\n    canvas = null;\n\n    value = {\n      data: dataURL,\n      type: 'image/png'\n    };\n  }\n\n  return value;\n});\n\nserialize.json.defaultReplacer.push(function(key, value) {\n  if (value === null) {\n    return value;\n  }\n\n  if (value.toJSON && typeof value.toJSON === 'function') {\n    value = value.toJSON();\n  }\n\n  return value;\n});\n\nserialize.json.defaultReplacer.push(function(key, value) {\n  // Functions are not allowed expect for the descriptor\n  if (typeof value !== 'function') {\n    return value;\n  } else {\n    if (key === 'descriptor') {\n      return value;\n    }\n  }\n});\n\nserialize.toJSON = function(obj, replacer) {\n  var clonedObj = {};\n\n  var replacers = [].concat.apply([], [serialize.json.defaultReplacer, replacer]);\n  \n\n  for (var key in obj) {\n    (function(key, value) {\n      if (!Object.hasOwnProperty.call(obj, key)) {\n        return;\n      }\n\n      if (serialize.json.filter.indexOf(key) >= 0) {\n        return;\n      }\n\n      for (var i = 0, j = replacers.length; i < j; i++) {\n        (function(rep) {\n          if (rep) {\n            value = rep.call(obj, key, value);\n          }\n        })(replacers[i]);\n      }\n\n      if (typeof value !== 'undefined') {\n        clonedObj[key] = value;\n      }\n    })(key, obj[key]);\n  }\n\n  return clonedObj;\n};\n\nserialize.toString = function(obj) {\n  return JSON.stringify(serialize.toJSON(obj), function(key, value) {\n    // Functions that are still left should be stringified\n\n    if (typeof value === 'function') {\n      value = value.toString();\n    }\n\n    return value;\n  });\n};\n\nexport default serialize;\n"]}